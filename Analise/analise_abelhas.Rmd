---
title: "Composi√ß√£o/diversidade de comunidades de abelhas em fun√ß√£o da estrutura da paisagem"
subtitle: "Estrutura da Paisagem (propor√ß√£o de habitat natural x heterogeneidade) e Composi√ß√£o de Esp√©cies"
author: "Cinthia Soares Novaes"
date: "`r format(Sys.Date(), '%d de %B de %Y')`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: true
    theme: flatly
    highlight: tango
    code_folding: show
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 10,
  fig.height = 7,
  fig.align = 'center'
)
```

# Introdu√ß√£o {.tabset}

## Contexto
*Pergunta: Como a composi√ß√£o e a diversidade de abelhas respondem √† estrutura da paisagem, considerando a propor√ß√£o de habitat natural e a heterogeneidade de usos e coberturas do solo?*

**H1:** A diversidade e a composi√ß√£o de abelhas est√£o mais fortemente associadas √† propor√ß√£o de habitat natural, de modo que √°reas com maior cobertura natural apresentam maior diversidade de esp√©cies.

**H2:** Mosaicos de diferentes classes de uso e cobertura do solo oferecem recursos complementares que sustentam maior diversidade e mant√™m comunidades distintas, tornando a heterogeneidade da paisagem um preditor mais importante.

**H0:** N√£o h√° associa√ß√£o significativa entre a propor√ß√£o de habitat natural e a heterogeneidade da paisagem e os padr√µes de diversidade e composi√ß√£o de abelhas neste estudo. As diferen√ßas observadas podem ser atribu√≠das ao acaso ou a fatores n√£o identificados na presente abordagem.


**Delineamento amostral:**
- **6 locais** com diferentes contextos (3 bordas urbanas + 3 zonas rurais)
- **Locais urbanos: TM, IF e MARM**
- **Locais rurais: CUR, SG e MV** 
- **9 pontos** por local
- **Total: 54 pontos amostrais**

## Objetivos

Os principais objetivos desta an√°lise s√£o:

1. **Diversidade Alfa**: Avaliar como a propo√ß√£o de habitat natural e a heterogeneidade da paisagem afetam a riqueza de esp√©cies (usando GLMM para controlar pseudorreplica√ß√£o)
2. **Composi√ß√£o Beta**: Testar se √°reas de borda urbana diferem de zonas rurais em termos de composi√ß√£o de esp√©cies
3. **An√°lises Multivariadas**: Identificar padr√µes espaciais e esp√©cies indicadoras

## M√©todos Estat√≠sticos

- **GLMM (Modelo Misto)**: Riqueza por ponto (n=54) com Local como efeito aleat√≥rio
- **NMDS**: Ordena√ß√£o da composi√ß√£o de esp√©cies
- **PERMANOVA**: Teste de efeito de vari√°veis ambientais na composi√ß√£o
- **ANOSIM**: Diferen√ßas entre grupos (contextos e locais)
- **IndVal e SIMPER**: Esp√©cies indicadoras e contribuintes

---

# Configura√ß√£o Inicial

## Carregar Pacotes

```{r pacotes}
library(tidyverse)
library(readxl)
library(vegan)
library(lme4)      # Para modelos mistos
library(MuMIn)
library(indicspecies)
library(ggplot2)
library(viridis)
library(gridExtra)
library(car)
```

## Importar e Limpar Dados

```{r importar-dados}
# Importar dados
dados <- read_excel("../dados/Cap2.xlsx", sheet = "Doc_Cinthia")

# Limpeza de dados
dados <- dados %>%
  filter(
    Especie != "Vespa",
    Especie != "NA",
    !is.na(Especie),
    Especie != "Crabronidae sp.",
    Especie != "Xylocopa grisescens"
  ) %>%
  mutate(
    # Corrigir nomes com espa√ßos
    Especie = str_trim(Especie),
    
    # Calcular total da paisagem
    total_paisagem = Area_Natural + Area_Urbana + Pastagem + Mosaico_Usos +
      Areas_nao_veg. + Mineracao + Lagos + Lavouras_Temp.,
    
    # Criar contexto espacial
    contexto = case_when(
      Local %in% c("TM_", "IF_", "MARM_") ~ "Borda_Urbana",
      Local %in% c("SG_", "MV_", "CUR_") ~ "Zona_Rural",
      TRUE ~ NA_character_
    ),
    
    # Criar ID √∫nico para cada ponto
    ID_ponto = paste(Local, Ponto, sep = "_")
  )

# Resumo dos dados
cat("üìä DADOS CARREGADOS:\n")
cat("  - Total de registros:", nrow(dados), "\n")
cat("  - N√∫mero de esp√©cies:", n_distinct(dados$Especie), "\n")
cat("  - Locais amostrados:", n_distinct(dados$Local), "\n")
cat("  - Pontos √∫nicos:", n_distinct(dados$ID_ponto), "\n")
```

---

# Diversidade Alfa (GLMM - 54 pontos)

## Calcular Riqueza por Ponto

```{r riqueza-pontos}
riqueza_por_ponto <- dados %>%
  group_by(ID_ponto) %>%
  summarise(
    Local = first(Local),
    contexto = first(contexto),
    prop_hab_natural = first(Area_Natural) / first(total_paisagem),
    heterogeneidade = vegan::diversity(
      c(first(Area_Urbana), first(Pastagem), first(Mosaico_Usos),
        first(Areas_nao_veg.), first(Mineracao), first(Lagos), 
        first(Lavouras_Temp.)),
      index = "shannon"
    ),
    riqueza = n_distinct(Especie),
    abundancia = n(),
    .groups = "drop"
  )

cat("üìä Resumo da riqueza por ponto:\n")
print(summary(riqueza_por_ponto))

cat("\nüìà Estat√≠sticas descritivas:\n")
cat("  - Riqueza m√©dia:", round(mean(riqueza_por_ponto$riqueza), 2), "¬±", 
    round(sd(riqueza_por_ponto$riqueza), 2), "\n")
cat("  - Riqueza m√≠nima:", min(riqueza_por_ponto$riqueza), "\n")
cat("  - Riqueza m√°xima:", max(riqueza_por_ponto$riqueza), "\n")
```

## Modelos Lineares Generalizados Mistos (GLMM)

### Sele√ß√£o de Modelos

```{r glmm-selecao}
cat("\n=== AJUSTANDO GLMMs ===\n")
cat("Local √© inclu√≠do como efeito aleat√≥rio para controlar pseudorreplica√ß√£o\n\n")

# Modelos candidatos
m1 <- glmer(riqueza ~ prop_hab_natural + (1|Local), 
            data = riqueza_por_ponto, 
            family = poisson,
            control = glmerControl(optimizer = "bobyqa"))

m2 <- glmer(riqueza ~ heterogeneidade + (1|Local), 
            data = riqueza_por_ponto, 
            family = poisson,
            control = glmerControl(optimizer = "bobyqa"))

m3 <- glmer(riqueza ~ prop_hab_natural + heterogeneidade + (1|Local), 
            data = riqueza_por_ponto, 
            family = poisson,
            control = glmerControl(optimizer = "bobyqa"))

m4 <- glmer(riqueza ~ prop_hab_natural * heterogeneidade + (1|Local), 
            data = riqueza_por_ponto, 
            family = poisson,
            control = glmerControl(optimizer = "bobyqa"))

m5 <- glmer(riqueza ~ prop_hab_natural + heterogeneidade + contexto + (1|Local), 
            data = riqueza_por_ponto, 
            family = poisson,
            control = glmerControl(optimizer = "bobyqa"))

# Comparar modelos
tabela_modelos <- model.sel(m1, m2, m3, m4, m5)
print(tabela_modelos)
```

### Melhor Modelo

```{r glmm-melhor}
# Extrair melhor modelo
melhor_modelo <- get.models(tabela_modelos, subset = 1)[[1]]

cat("\nüìä MELHOR MODELO (menor AICc):\n")
cat("AICc:", round(AICc(melhor_modelo), 2), "\n")
cat("ŒîAICc:", round(tabela_modelos$delta[1], 2), "\n\n")

# Mostrar coeficientes
cat("Efeitos fixos:\n")
print(summary(melhor_modelo)$coefficients)

cat("\n\nVari√¢ncia do efeito aleat√≥rio (Local):\n")
print(VarCorr(melhor_modelo))

# Testar overdispersion
deviance_residual <- sum(residuals(melhor_modelo, type = "deviance")^2)
df_residual <- df.residual(melhor_modelo)
dispersion <- deviance_residual / df_residual

cat("\nüîç Teste de Overdispersion:", round(dispersion, 3), "\n")
if(dispersion > 1.5) {
  cat("‚ö†Ô∏è Overdispersion detectada (>1.5). Considere usar fam√≠lia Negative Binomial.\n")
} else {
  cat("‚úì Sem problemas de overdispersion.\n")
}

# VIF (verificar colinearidade - s√≥ para modelos com 2+ preditores fixos)
if(length(fixef(melhor_modelo)) > 2) {
  cat("\nüîç VIF (Colinearidade dos preditores):\n")
  cat("VIF > 3 indica colinearidade problem√°tica\n\n")
  print(vif(melhor_modelo))
}
```

**Interpreta√ß√£o:** O modelo misto (GLMM) usa os 54 pontos mas controla a n√£o-independ√™ncia dos pontos dentro de cada local atrav√©s do efeito aleat√≥rio `(1|Local)`. Isso √© estatisticamente mais robusto do que usar apenas os 6 locais.

---

# An√°lises Multivariadas (54 pontos)

## Preparar Matrizes

```{r preparar-matrizes}
# Matriz de comunidade: pontos √ó esp√©cies
matriz_comunidade_pontos <- dados %>%
  group_by(ID_ponto, Especie) %>%
  summarise(abundancia = n(), .groups = "drop") %>%
  pivot_wider(names_from = Especie, values_from = abundancia, values_fill = 0) %>%
  column_to_rownames("ID_ponto")

cat("üìê Dimens√µes da matriz:", dim(matriz_comunidade_pontos), "\n")
cat("   (", nrow(matriz_comunidade_pontos), " pontos √ó ", 
    ncol(matriz_comunidade_pontos), " esp√©cies)\n\n", sep = "")

# Vari√°veis ambientais por ponto
variaveis_pontos <- dados %>%
  group_by(ID_ponto) %>%
  summarise(
    Local = first(Local),
    contexto = first(contexto),
    prop_hab_natural = first(Area_Natural) / first(total_paisagem),
    heterogeneidade = vegan::diversity(
      c(first(Area_Urbana), first(Pastagem), first(Mosaico_Usos),
        first(Areas_nao_veg.), first(Mineracao), first(Lagos), 
        first(Lavouras_Temp.)),
      index = "shannon"
    ),
    .groups = "drop"
  ) %>%
  column_to_rownames("ID_ponto")

# Verificar alinhamento
cat("‚úì Alinhamento de matrizes:", 
    all(rownames(matriz_comunidade_pontos) == rownames(variaveis_pontos)), "\n")
```

## NMDS (Ordena√ß√£o)

```{r nmds}
cat("\n=== CALCULANDO NMDS ===\n")

set.seed(123)
nmds_pontos <- metaMDS(matriz_comunidade_pontos, 
                       distance = "bray", 
                       k = 2,
                       trymax = 100,
                       trace = FALSE)

cat("üìä Stress do NMDS (k=2):", round(nmds_pontos$stress, 4), "\n\n")
cat("Interpreta√ß√£o do Stress:\n")
cat("  < 0.05: Excelente\n")
cat("  0.05-0.10: √ìtimo\n")
cat("  0.10-0.20: Bom\n")
cat("  > 0.20: Regular/Ruim\n")

# Se stress alto, tentar k=3
if(nmds_pontos$stress > 0.20) {
  cat("\n‚ö†Ô∏è Stress alto! Tentando k=3...\n")
  nmds_pontos <- metaMDS(matriz_comunidade_pontos, 
                         distance = "bray", 
                         k = 3,
                         trymax = 100,
                         trace = FALSE)
  cat("‚úì Novo stress (k=3):", round(nmds_pontos$stress, 4), "\n")
}
```

## PERMANOVA

```{r permanova}
cat("\n\n=== PERMANOVA ===\n")

# Modelo 1: Vari√°veis ambientais cont√≠nuas
perm1 <- adonis2(matriz_comunidade_pontos ~ prop_hab_natural + heterogeneidade,
                 data = variaveis_pontos,
                 permutations = 999,
                 method = "bray")

# Modelo 2: Adicionando contexto
perm2 <- adonis2(matriz_comunidade_pontos ~ prop_hab_natural + heterogeneidade + contexto,
                 data = variaveis_pontos,
                 permutations = 999,
                 method = "bray")

# Modelo 3: Com intera√ß√£o
perm3 <- adonis2(matriz_comunidade_pontos ~ (prop_hab_natural + heterogeneidade) * contexto,
                 data = variaveis_pontos,
                 permutations = 999,
                 method = "bray")

# Modelo 4: Bloqueado por Local (controla pseudorreplica√ß√£o)
perm_blocked <- adonis2(matriz_comunidade_pontos ~ prop_hab_natural + heterogeneidade,
                        data = variaveis_pontos,
                        permutations = 999,
                        method = "bray",
                        strata = variaveis_pontos$Local)

cat("\n--- PERMANOVA: Habitat + Heterogeneidade ---\n")
print(perm1)
cat("\n--- PERMANOVA: + Contexto ---\n")
print(perm2)
cat("\n--- PERMANOVA: Com Intera√ß√£o ---\n")
print(perm3)
cat("\n--- PERMANOVA BLOQUEADA por Local (RECOMENDADO) ---\n")
print(perm_blocked)
```

**Interpreta√ß√£o:** A PERMANOVA testa se as vari√°veis ambientais explicam diferen√ßas na composi√ß√£o de esp√©cies. O R¬≤ indica a propor√ß√£o da vari√¢ncia explicada. O modelo bloqueado controla a pseudorreplica√ß√£o dos pontos dentro de cada local.

## ANOSIM

```{r anosim}
cat("\n\n=== ANOSIM ===\n")

# Calcular matriz de dist√¢ncia
dist_bray <- vegdist(matriz_comunidade_pontos, method = "bray")

# 1. Por CONTEXTO
anosim_contexto <- anosim(dist_bray, variaveis_pontos$contexto, permutations = 999)

# 2. Por LOCAL
anosim_local <- anosim(dist_bray, variaveis_pontos$Local, permutations = 999)

# 3. Por categoria de HABITAT
tercis <- quantile(variaveis_pontos$prop_hab_natural, probs = c(0.33, 0.67))
categoria_habitat <- cut(variaveis_pontos$prop_hab_natural,
                         breaks = c(-Inf, tercis[1], tercis[2], Inf),
                         labels = c("Baixo", "Medio", "Alto"))
anosim_habitat <- anosim(dist_bray, categoria_habitat, permutations = 999)

cat("--- ANOSIM: Borda Urbana vs Zona Rural ---\n")
print(summary(anosim_contexto))
cat("\n--- ANOSIM: Entre os 6 Locais ---\n")
print(summary(anosim_local))
cat("\n--- ANOSIM: Por Categoria de Habitat ---\n")
print(summary(anosim_habitat))
```

### ANOSIM Pairwise

```{r anosim-pairwise}
cat("\n--- ANOSIM Pairwise (Compara√ß√µes entre Locais) ---\n")

locais_unicos <- unique(variaveis_pontos$Local)
n_locais <- length(locais_unicos)

resultados_pairwise <- data.frame(
  Comparacao = character(),
  R_statistic = numeric(),
  p_value = numeric(),
  stringsAsFactors = FALSE
)

for(i in 1:(n_locais-1)) {
  for(j in (i+1):n_locais) {
    local_A <- locais_unicos[i]
    local_B <- locais_unicos[j]
    
    indices <- variaveis_pontos$Local %in% c(local_A, local_B)
    dist_sub <- as.dist(as.matrix(dist_bray)[indices, indices])
    grupos_sub <- variaveis_pontos$Local[indices]
    
    anosim_pair <- anosim(dist_sub, grupos_sub, permutations = 999)
    
    resultados_pairwise <- rbind(resultados_pairwise, 
                                 data.frame(
                                   Comparacao = paste(local_A, "vs", local_B),
                                   R_statistic = anosim_pair$statistic,
                                   p_value = anosim_pair$signif
                                 ))
  }
}

resultados_pairwise$p_adjusted <- p.adjust(resultados_pairwise$p_value, method = "bonferroni")
resultados_pairwise <- resultados_pairwise %>% arrange(desc(R_statistic))

print(resultados_pairwise)
```

## ENVFIT (Vetores Ambientais)

```{r envfit}
cat("\n\n=== ENVFIT: Vetores Ambientais ===\n")

envfit_resultado <- envfit(nmds_pontos, 
                           variaveis_pontos[, c("prop_hab_natural", "heterogeneidade")],
                           permutations = 999)
print(envfit_resultado)
```

## Esp√©cies Indicadoras

```{r especies-indicadoras}
cat("\n\n=== ESP√âCIES INDICADORAS ===\n")

# IndVal por contexto
indval_contexto <- multipatt(matriz_comunidade_pontos, 
                             variaveis_pontos$contexto,
                             control = how(nperm = 999))

cat("--- IndVal: Borda Urbana vs Zona Rural ---\n")
print(summary(indval_contexto, indvalcomp = TRUE))

# SIMPER
simper_contexto <- simper(matriz_comunidade_pontos, variaveis_pontos$contexto)
cat("\n--- SIMPER: Esp√©cies que diferenciam contextos ---\n")
cat("(Mostrando top 10 esp√©cies)\n\n")
print(summary(simper_contexto, ordered = TRUE)[[1]][1:10, ])
```

---

# Visualiza√ß√µes

## Preparar Dados para Gr√°ficos

```{r preparar-graficos}
nmds_scores <- as.data.frame(scores(nmds_pontos, display = "sites"))
nmds_scores$ID_ponto <- rownames(nmds_scores)
nmds_scores <- nmds_scores %>%
  left_join(variaveis_pontos %>% rownames_to_column("ID_ponto"), by = "ID_ponto")
```

## NMDS por Contexto

```{r fig-nmds-contexto, fig.cap="Figura 1: Composi√ß√£o de abelhas em bordas urbanas vs zonas rurais", fig.width=10, fig.height=8}
hull_contexto <- nmds_scores %>%
  group_by(contexto) %>%
  slice(chull(NMDS1, NMDS2))

ggplot() +
  geom_polygon(data = hull_contexto, 
               aes(x = NMDS1, y = NMDS2, fill = contexto, group = contexto),
               alpha = 0.3) +
  geom_point(data = nmds_scores, 
             aes(x = NMDS1, y = NMDS2, color = contexto, shape = contexto),
             size = 4, alpha = 0.8) +
  scale_fill_manual(values = c("Borda_Urbana" = "#E74C3C", "Zona_Rural" = "#27AE60")) +
  scale_color_manual(values = c("Borda_Urbana" = "#E74C3C", "Zona_Rural" = "#27AE60")) +
  coord_equal() +
  theme_bw(base_size = 14) +
  theme(
    legend.position = "top",
    legend.title = element_text(face = "bold"),
    panel.grid = element_blank()
  ) +
  labs(
    x = "NMDS1", y = "NMDS2",
    title = paste0("Composi√ß√£o de abelhas: Borda Urbana vs Zona Rural\n(Stress = ", 
                   round(nmds_pontos$stress, 3), ")"),
    subtitle = paste0("ANOSIM R = ", round(anosim_contexto$statistic, 3), 
                      ", p = ", anosim_contexto$signif),
    color = "Contexto", fill = "Contexto", shape = "Contexto"
  )
```

## NMDS por Local

```{r fig-nmds-local, fig.cap="Figura 2: Composi√ß√£o de abelhas por local de amostragem", fig.width=11, fig.height=8}
hull_local <- nmds_scores %>%
  group_by(Local) %>%
  slice(chull(NMDS1, NMDS2))

ggplot() +
  geom_polygon(data = hull_local, 
               aes(x = NMDS1, y = NMDS2, fill = Local, group = Local),
               alpha = 0.3) +
  geom_point(data = nmds_scores, 
             aes(x = NMDS1, y = NMDS2, color = Local),
             size = 3.5, alpha = 0.8) +
  scale_fill_viridis_d(option = "turbo") +
  scale_color_viridis_d(option = "turbo") +
  coord_equal() +
  theme_bw(base_size = 14) +
  theme(legend.position = "right", panel.grid = element_blank()) +
  labs(
    x = "NMDS1", y = "NMDS2",
    title = paste0("Composi√ß√£o por Local (Stress = ", round(nmds_pontos$stress, 3), ")"),
    subtitle = paste0("ANOSIM R = ", round(anosim_local$statistic, 3), 
                      ", p = ", anosim_local$signif)
  )
```

## Gradiente de Habitat Natural

```{r fig-gradiente, fig.cap="Figura 3: Gradiente de propor√ß√£o de habitat natural", fig.width=10, fig.height=8}
ggplot(nmds_scores, aes(x = NMDS1, y = NMDS2, color = prop_hab_natural)) +
  geom_point(size = 4, alpha = 0.8) +
  scale_color_viridis_c(name = "Propor√ß√£o\nHabitat Natural", option = "plasma") +
  coord_equal() +
  theme_bw(base_size = 14) +
  theme(panel.grid = element_blank()) +
  labs(
    x = "NMDS1", y = "NMDS2",
    title = paste0("Gradiente de Habitat Natural (Stress = ", round(nmds_pontos$stress, 3), ")")
  )
```

## Vetores Ambientais (ENVFIT)

```{r fig-envfit, fig.cap="Figura 4: Vetores ambientais correlacionados com a ordena√ß√£o", fig.width=10, fig.height=8}
envfit_coords <- as.data.frame(scores(envfit_resultado, "vectors")) * 0.5

ggplot() +
  geom_point(data = nmds_scores, 
             aes(x = NMDS1, y = NMDS2, color = contexto),
             size = 3, alpha = 0.7) +
  geom_segment(data = envfit_coords,
               aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2),
               arrow = arrow(length = unit(0.3, "cm")),
               color = "black", size = 1.2) +
  geom_text(data = envfit_coords,
            aes(x = NMDS1 * 1.1, y = NMDS2 * 1.1, label = rownames(envfit_coords)),
            size = 5, fontface = "bold") +
  scale_color_manual(values = c("Borda_Urbana" = "#E74C3C", "Zona_Rural" = "#27AE60")) +
  coord_equal() +
  theme_bw(base_size = 14) +
  theme(panel.grid = element_blank()) +
  labs(x = "NMDS1", y = "NMDS2", title = "Vetores Ambientais (ENVFIT)", color = "Contexto")
```

## ANOSIM Pairwise

```{r fig-anosim, fig.width=10, fig.height=12, fig.cap="Figura 5: Compara√ß√µes par-a-par entre locais"}
ggplot(resultados_pairwise, 
       aes(x = reorder(Comparacao, R_statistic), y = R_statistic,
           fill = p_adjusted < 0.05)) +
  geom_col() +
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "red", size = 1) +
  scale_fill_manual(
    values = c("TRUE" = "#27AE60", "FALSE" = "gray70"),
    labels = c("p < 0.05", "p ‚â• 0.05"),
    name = "Signific√¢ncia"
  ) +
  coord_flip() +
  theme_bw(base_size = 12) +
  labs(
    x = "Compara√ß√£o entre Locais",
    y = "ANOSIM R statistic",
    title = "Diferencia√ß√£o Par-a-Par entre Locais",
    subtitle = "Linha tracejada: R = 0.5 (diferen√ßa forte)"
  )
```

## Riqueza vs Habitat Natural

```{r fig-riqueza-habitat, fig.cap="Figura 6: Rela√ß√£o entre riqueza e propor√ß√£o de habitat natural", fig.width=10, fig.height=7}
ggplot(riqueza_por_ponto, aes(x = prop_hab_natural, y = riqueza, color = contexto)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_smooth(method = "glm", method.args = list(family = "poisson"), 
              se = TRUE, linewidth = 1.2) +
  scale_color_manual(values = c("Borda_Urbana" = "#E74C3C", "Zona_Rural" = "#27AE60"),
                     name = "Contexto") +
  theme_bw(base_size = 14) +
  theme(
    legend.position = "top",
    panel.grid.minor = element_blank()
  ) +
  labs(
    x = "Propor√ß√£o de Habitat Natural",
    y = "Riqueza de Esp√©cies",
    title = "Rela√ß√£o entre Habitat Natural e Riqueza de Abelhas",
    subtitle = "Linhas = predi√ß√µes do GLM Poisson por contexto"
  )
```

---

# Tabela Resumo

```{r tabela-resumo}
resumo_analises <- data.frame(
  Analise = c(
    "GLMM - Melhor modelo",
    "PERMANOVA - Habitat + Heterog",
    "PERMANOVA - + Contexto",
    "PERMANOVA - Intera√ß√£o",
    "PERMANOVA - Bloqueada",
    "ANOSIM - Borda vs Rural",
    "ANOSIM - Entre Locais",
    "ANOSIM - Categoria Habitat",
    "ENVFIT - Habitat Natural",
    "ENVFIT - Heterogeneidade"
  ),
  Estatistica = c(
    paste0("AICc = ", round(AICc(melhor_modelo), 1)),
    paste0("R¬≤ = ", round(perm1$R2[1], 3)),
    paste0("R¬≤ = ", round(perm2$R2[1], 3)),
    paste0("R¬≤ = ", round(perm3$R2[1], 3)),
    paste0("R¬≤ = ", round(perm_blocked$R2[1], 3)),
    paste0("R = ", round(anosim_contexto$statistic, 3)),
    paste0("R = ", round(anosim_local$statistic, 3)),
    paste0("R = ", round(anosim_habitat$statistic, 3)),
    paste0("r¬≤ = ", round(envfit_resultado$vectors$r[1], 3)),
    paste0("r¬≤ = ", round(envfit_resultado$vectors$r[2], 3))
  ),
  p_value = c(
    ifelse(length(fixef(melhor_modelo)) > 2, 
           round(summary(melhor_modelo)$coefficients[2, 4], 4), 
           "‚Äî"),
    round(perm1$`Pr(>F)`[1], 4),
    round(perm2$`Pr(>F)`[1], 4),
    round(perm3$`Pr(>F)`[1], 4),
    round(perm_blocked$`Pr(>F)`[1], 4),
    round(anosim_contexto$signif, 4),
    round(anosim_local$signif, 4),
    round(anosim_habitat$signif, 4),
    round(envfit_resultado$vectors$pvals[1], 4),
    round(envfit_resultado$vectors$pvals[2], 4)
  )
)

resumo_analises
```

---

# Conclus√µes

## Principais Resultados

Este documento apresentou uma an√°lise completa das comunidades de abelhas do Cerrado, incluindo:

### 1. Diversidade Alfa (GLMM)

- Utilizamos **modelos mistos** (GLMM) com os **54 pontos**, controlando a pseudorreplica√ß√£o atrav√©s do efeito aleat√≥rio de Local
- Esta abordagem √© **estatisticamente mais robusta** do que usar apenas os 6 locais como unidades independentes
- O melhor modelo (menor AICc) foi selecionado atrav√©s de compara√ß√£o entre modelos candidatos

### 2. Composi√ß√£o Beta

- **NMDS** revelou padr√µes claros de separa√ß√£o entre contextos (stress = `r round(nmds_pontos$stress, 3)`)
- **PERMANOVA** confirmou o efeito significativo das vari√°veis ambientais na composi√ß√£o
- **ANOSIM** mostrou diferen√ßas significativas entre bordas urbanas e zonas rurais (R = `r round(anosim_contexto$statistic, 3)`, p = `r anosim_contexto$signif`)

### 3. Esp√©cies Indicadoras

- **IndVal** e **SIMPER** identificaram esp√©cies caracter√≠sticas de cada contexto
- Estas esp√©cies podem servir como bioindicadoras de qualidade ambiental

## Destaques Metodol√≥gicos

‚úÖ **Controle de Pseudorreplica√ß√£o**: Uso de GLMM e PERMANOVA bloqueada  
‚úÖ **M√∫ltiplas Escalas**: An√°lises em n√≠vel de ponto (54) e local (6)  
‚úÖ **Robustez Estat√≠stica**: Sele√ß√£o de modelos via AICc  
‚úÖ **Visualiza√ß√µes Claras**: Gr√°ficos de alta qualidade para publica√ß√£o

## Arquivos Gerados

Este script gera automaticamente:

- ‚úÖ 6 figuras de alta qualidade (incorporadas neste relat√≥rio)
- ‚úÖ Este relat√≥rio HTML completo e reproduz√≠vel
- ‚úÖ Todas as an√°lises estat√≠sticas necess√°rias

---

# Informa√ß√µes da Sess√£o

```{r sessao}
sessionInfo()
```

---

<div style="text-align: center; margin-top: 50px; padding: 20px; background-color: #f0f0f0; border-radius: 10px;">
**An√°lise realizada em:** `r format(Sys.Date(), '%d/%m/%Y')`

**Reposit√≥rio GitHub:** [Adicione o link aqui quando criar]

**Contato:** cinthia.soares@ufvjm.edu.br

---

*Documento gerado com R Markdown*
</div>